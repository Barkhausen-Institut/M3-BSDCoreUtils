include(${CMAKE_CURRENT_SOURCE_DIR}/../../cmake/manpage.cmake)

add_executable(mknod mknod.c)

target_link_libraries(mknod PRIVATE compat)

if(${CMAKE_SYSTEM_NAME} STREQUAL "Linux")
    set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -D_GNU_SOURCE")
endif()

INSTALL(TARGETS mknod DESTINATION ${CMAKE_INSTALL_BINDIR})

file(COPY ${CMAKE_CURRENT_SOURCE_DIR}/mkfifo.1 DESTINATION ${CMAKE_CURRENT_BINARY_DIR})
file(COPY ${CMAKE_CURRENT_SOURCE_DIR}/mknod.8 DESTINATION ${CMAKE_CURRENT_BINARY_DIR})

install_symlink(${CMAKE_INSTALL_PREFIX}/bin/mknod ${CMAKE_INSTALL_PREFIX}/bin/mkfifo)
INSTALL(FILES ${CMAKE_CURRENT_BINARY_DIR}/mkfifo.1 DESTINATION ${CMAKE_INSTALL_PREFIX}/man/man1)
INSTALL(FILES ${CMAKE_CURRENT_BINARY_DIR}/mknod.8 DESTINATION ${CMAKE_INSTALL_PREFIX}/man/man8)